import { query, useLocation } from "@solidjs/router";
import { createResource } from "solid-js";

import fetch from "{{importPathmap.fetch}}";

{{#each apiRoutes}}
import type { ResponseT as {{importName}} } from "{{importPathmap.fetch}}";
{{/each}}

type ResourceMap = {
  {{#each apiRoutes}}
  "{{name}}": {{importName}} extends { GET: unknown }
    ? {{importName}}["GET"]
    : unknown;
  {{/each}}
}

export const useResource = <K extends keyof ResourceMap>(routeName: K) => {
  const location = useLocation();
  const fetchData = () => fetch[routeName].GET();
  const queryData = query(fetchData, routeName);
  return createResource<ResourceMap[K]>(
    () => location.pathname as never,
    queryData as never,
  );
};

