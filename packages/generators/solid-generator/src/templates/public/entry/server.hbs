import { renderToString, generateHydrationScript } from "solid-js/web";

import Router from "../router";

export default {
  async factory(url) {
    const hydrationScript = generateHydrationScript();

    return {
      renderToString({ criticalCss }) {
        const head = criticalCss.reduce(
          (head, { text }) => `${head}<style>${text}</style>`,
          hydrationScript,
        );

        const html = renderToString(() => Router({ url }));

        return { head, html };
      },
    };
  },
} satisfies import("@kosmojs/dev").SSRSetup;
