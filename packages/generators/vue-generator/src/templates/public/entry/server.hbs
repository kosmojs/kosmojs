import { createSSRApp } from "vue";
import { renderToString } from "vue/server-renderer";

import App from "../App.vue";
import createRouter from "../router";

export default {
  async factory(url) {
    const app = createSSRApp(App);
    const router = await createRouter({ url });

    app.use(router);

    return {
      async renderToString({ criticalCss }) {
        const head = criticalCss
          .map(({ text }) => `<style>${text}</style>`)
          .join("");

        const html = await renderToString(app);

        return { head, html };
      },
    };
  },
} satisfies import("@kosmojs/dev").SSRSetup;
