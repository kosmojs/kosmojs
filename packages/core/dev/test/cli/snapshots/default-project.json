[
  [
    "default-project/.env",
    [
      "VITE_HOSTNAME=localhost"
    ]
  ],
  [
    "default-project/core/api/app.ts",
    [
      "import { type AppOptions, createApp } from \"@kosmojs/api\";",
      "",
      "export default (options?: AppOptions) => {",
      "  const app = createApp(options);",
      "  return app;",
      "};"
    ]
  ],
  [
    "default-project/core/api/env.d.ts",
    [
      "export declare module \"@kosmojs/api\" {",
      "  interface DefaultState {}",
      "  interface DefaultContext {}",
      "}"
    ]
  ],
  [
    "default-project/core/api/router.ts",
    [
      "import { createRouter, type RouterOptions } from \"@kosmojs/api\";",
      "",
      "export default (options?: RouterOptions) => {",
      "  const router = createRouter(options);",
      "  return router;",
      "};"
    ]
  ],
  [
    "default-project/core/api/server.ts",
    [
      "import { chmod, unlink } from \"node:fs/promises\";",
      "import { parseArgs } from \"node:util\";",
      "",
      "import type { App } from \"@kosmojs/api\";",
      "",
      "const {",
      "  values: { port, sock },",
      "} = parseArgs({",
      "  options: {",
      "    port: {",
      "      type: \"string\",",
      "      short: \"p\",",
      "    },",
      "    sock: {",
      "      type: \"string\",",
      "      short: \"s\",",
      "    },",
      "  },",
      "});",
      "",
      "if (![port, sock].some((e) => e)) {",
      "  console.error(\"Please provide either -p/--port number or -s/--sock path\");",
      "  process.exit(1);",
      "}",
      "",
      "console.log(\"\\n  ➜ Starting Server\", { port, sock });",
      "",
      "if (sock) {",
      "  await unlink(sock).catch((error) => {",
      "    if (error.code === \"ENOENT\") {",
      "      return;",
      "    }",
      "    console.error(error.message);",
      "    process.exit(1);",
      "  });",
      "}",
      "",
      "export default async <T extends App = App>(",
      "  createApp: () => T | Promise<T>,",
      "): Promise<import(\"node:http\").Server> => {",
      "  const app = await createApp();",
      "  // app.listen is returning the actual server",
      "  return app.listen(port || sock, async () => {",
      "    if (sock) {",
      "      await chmod(sock, 0o777);",
      "    }",
      "    console.log(\"\\n  ➜ Server Started ✨\\n\");",
      "  });",
      "};"
    ]
  ],
  [
    "default-project/core/api/use.ts",
    [
      "import { use } from \"@kosmojs/api\";",
      "import bodyparser from \"@kosmojs/api/bodyparser\";",
      "",
      "// Middleware applied to all routes by default.",
      "// Can be overridden on a per-route basis using the slot key.",
      "export default [",
      "  use(bodyparser.json(), {",
      "    on: [\"POST\", \"PUT\", \"PATCH\"],",
      "    slot: \"bodyparser\",",
      "  }),",
      "",
      "  use(",
      "    (ctx, next) => {",
      "      ctx.payload = [\"POST\", \"PUT\", \"PATCH\"].includes(ctx.method)",
      "        ? ctx.request.body",
      "        : ctx.query;",
      "      return next();",
      "    },",
      "    { slot: \"payload\" },",
      "  ),",
      "];"
    ]
  ],
  [
    "default-project/esbuild.json",
    [
      "{",
      "  \"bundle\": true,",
      "  \"platform\": \"node\",",
      "  \"target\": \"node22\",",
      "  \"format\": \"esm\",",
      "  \"packages\": \"external\",",
      "  \"sourcemap\": \"linked\",",
      "  \"logLevel\": \"info\"",
      "}"
    ]
  ],
  [
    "default-project/package.json",
    [
      [
        "type",
        "module"
      ],
      [
        "distDir",
        "dist"
      ],
      [
        "scripts",
        {
          "dev": "kosmo dev",
          "build": "kosmo build",
          "+folder": "kosmo folder"
        }
      ],
      [
        "pnpm",
        {
          "onlyBuiltDependencies": [
            "esbuild"
          ]
        }
      ]
    ]
  ],
  [
    "default-project/tsconfig.json",
    [
      "{",
      "  \"extends\": \"@kosmojs/config/tsconfig.vite.json\",",
      "  \"compilerOptions\": {",
      "    \"paths\": {",
      "      \"@/*\": [",
      "        \"./*\",",
      "        \"./lib/*\"",
      "      ]",
      "    }",
      "  }",
      "}"
    ]
  ],
  [
    "default-project/vite.base.ts",
    [
      "import { basename, resolve } from \"node:path\";",
      "",
      "import { aliasPlugin, definePlugin } from \"@kosmojs/dev\";",
      "import { loadEnv, mergeConfig, type UserConfig } from \"vite\";",
      "",
      "import pkg from \"./package.json\" with { type: \"json\" };",
      "",
      "export default async (sourceFolderPath: string, config: UserConfig) => {",
      "  const env = loadEnv(\"mock\", import.meta.dirname);",
      "  const sourceFolder = basename(sourceFolderPath);",
      "  return mergeConfig(config, {",
      "    build: {",
      "      outDir: resolve(import.meta.dirname, `${pkg.distDir}/${sourceFolder}`),",
      "      emptyOutDir: true,",
      "      sourcemap: true,",
      "    },",
      "",
      "    server: {",
      "      host: true,",
      "      allowedHosts: [env.VITE_HOSTNAME],",
      "      fs: {",
      "        strict: false,",
      "      },",
      "      watch: {",
      "        awaitWriteFinish: {",
      "          stabilityThreshold: 800,",
      "          pollInterval: 200,",
      "        },",
      "      },",
      "    },",
      "",
      "    cacheDir: resolve(import.meta.dirname, `var/.vite/${sourceFolder}`),",
      "",
      "    plugins: [",
      "      aliasPlugin(import.meta.dirname),",
      "      definePlugin([",
      "        {",
      "          // keys extracted from process.env and exposed to client",
      "          keys: [\"DEBUG\"],",
      "        },",
      "      ]),",
      "    ],",
      "  });",
      "};"
    ]
  ]
]